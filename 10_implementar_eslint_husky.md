No mundo dos testes automatizados, consist√™ncia √© rei. Quando voc√™ est√° trabalhando em uma equipe, √© f√°cil para diferentes estilos de codifica√ß√£o e pequenos erros se infiltrarem na base de c√≥digo. Isso leva a c√≥digo bagun√ßado, testes quebrados e revis√µes de c√≥digo frustrantes. Mas e se voc√™ pudesse aplicar automaticamente padr√µes de qualidade antes que c√≥digo ruim seja commitado?

Ao final deste tutorial, voc√™ ter√° um sistema totalmente automatizado que faz lint, formata e valida seu c√≥digo toda vez que voc√™ tentar fazer commit.


## üõ†Ô∏èO Time dos Sonhos: Nossas Ferramentas Explicadas
Vamos usar uma combina√ß√£o poderosa de quatro ferramentas para criar nossa rede de seguran√ßa pr√©-commit. Aqui est√° um r√°pido resumo do que cada uma faz:

- **ESLint üßê**: Uma ferramenta de an√°lise est√°tica que escaneia seu c√≥digo para encontrar e relatar padr√µes, bugs potenciais e erros estil√≠sticos com base em um conjunto configur√°vel de regras.
- **Prettier ‚ú®**: Um formatador de c√≥digo opinativo. Ele imp√µe um estilo consistente analisando seu c√≥digo e reimprimindo-o com suas pr√≥prias regras, economizando debates de formata√ß√£o.
- **Husky üêï‚Äçü¶∫**: Uma ferramenta que torna incrivelmente simples trabalhar com Git hooks. Vamos us√°-lo para configurar um hook "pre-commit", que √© um script que roda logo antes de um commit ser finalizado.
- **lint-staged üö´**: O parceiro perfeito para o Husky. Ele permite que voc√™ execute linters e formatadores apenas contra os arquivos que foram staged no Git, tornando o processo r√°pido e eficiente.

Agora, vamos integr√°-los ao seu projeto Playwright.

## ü™úGuia de Implementa√ß√£o Passo a Passo
Siga estes passos cuidadosamente para construir suas verifica√ß√µes automatizadas.

### Etapa 1: üì¶Instalar Suas Depend√™ncias
Primeiro, precisamos adicionar nossas novas ferramentas ao projeto. Abaixo est√° o comando que instalar√° todas as depend√™ncias para nosso caso:

```bash
npm install --save-dev @typescript-eslint/eslint-plugin@^8.34.1 @typescript-eslint/parser@^8.34.1 eslint@^9.29.0 eslint-config-prettier@^10.1.5 eslint-define-config@^2.1.0 eslint-plugin-playwright@^2.2.0 eslint-plugin-prettier@^5.5.0 husky@^9.1.7 jiti@^2.4.2 lint-staged@^16.1.2
```

Abra seu arquivo package.json e verifique os seguintes pacotes em suas devDependencies (provavelmente suas vers√µes ser√£o mais recentes):

```json
"devDependencies": {
        "@playwright/test": "^1.53.2",
        "@types/node": "^24.0.12",
        "@typescript-eslint/eslint-plugin": "^8.36.0",
        "@typescript-eslint/parser": "^8.36.0",
        "eslint": "^9.30.1",
        "eslint-config-prettier": "^10.1.5",
        "eslint-define-config": "^2.1.0",
        "eslint-plugin-playwright": "^2.2.0",
        "eslint-plugin-prettier": "^5.5.1",
        "husky": "^9.1.7",
        "jiti": "^2.4.2",
        "lint-staged": "^16.1.2"
    }
```

### Etapa 2: ‚ú®Configurar Prettier para Formata√ß√£o Consistente
**Instale a extens√£o Prettier no seu IDE:**
- Prettier

**Altere as op√ß√µes "Default Formatter" e "Format On Save" no seu IDE:**
- Pressione `Ctrl + Shift + P` e digite "Preferences: Open Settings (UI)"
- Abra e na barra de pesquisa, digite "format:"
- Fa√ßa as altera√ß√µes necess√°rias para habilitar formata√ß√£o autom√°tica

Crie um novo arquivo no diret√≥rio raiz do seu projeto chamado `.prettierrc`. Este arquivo informa ao Prettier como voc√™ quer que seu c√≥digo seja formatado.

```json
{
    "semi": true,
    "tabWidth": 4,
    "useTabs": false,
    "printWidth": 80,
    "singleQuote": true,
    "trailingComma": "es5",
    "bracketSpacing": true,
    "arrowParens": "always",
    "proseWrap": "preserve"
}
```

**Explica√ß√£o de cada op√ß√£o do Prettier:**

- **`semi`**: (true) Sempre adicione um ponto e v√≠rgula no final de cada declara√ß√£o.
- **`tabWidth`**: (4) Use 4 espa√ßos por n√≠vel de indenta√ß√£o.
- **`useTabs`**: (false) Indente linhas com espa√ßos em vez de tabs.
- **`printWidth`**: (80) Quebra linhas em 80 caracteres para melhor legibilidade.
- **`singleQuote`**: (true) Use aspas simples em vez de aspas duplas sempre que poss√≠vel.
- **`trailingComma`**: ("es5") Adicione v√≠rgulas finais onde for v√°lido em ES5 (objetos, arrays, etc.).
- **`bracketSpacing`**: (true) Imprima espa√ßos entre colchetes em objetos literais (por exemplo, `{ foo: bar }`).
- **`arrowParens`**: ("always") Sempre inclua par√™nteses ao redor de par√¢metros de arrow function, mesmo se houver apenas um par√¢metro.
- **`proseWrap`**: ("preserve") N√£o altere a quebra em texto markdown; respeite as quebras de linha da entrada.

### Etapa 3: üìùConfigurar Seu TypeScript
Se voc√™ ainda n√£o tem um, crie um arquivo `tsconfig.json` no seu diret√≥rio raiz. Este arquivo especifica os arquivos raiz e as op√ß√µes de compilador necess√°rias para compilar um projeto TypeScript.

```json
{
    "compilerOptions": {
        "target": "ESNext",
        "module": "NodeNext",
        "lib": ["ESNext", "DOM"],
        "moduleResolution": "NodeNext",
        "esModuleInterop": true,
        "allowJs": true,
        "checkJs": false,
        "outDir": "./dist",
        "rootDir": ".",
        "strict": true,
        "noImplicitAny": true,
        "skipLibCheck": true,
        "forceConsistentCasingInFileNames": true,
        "resolveJsonModule": true,
        "types": ["node", "playwright"]
    },
    "include": [
        "*.ts",
        "*.mts",
        "tests/**/*.ts",
        "fixtures/**/*.ts",
        "pages/**/*.ts",
        "helpers/**/*.ts",
        "enums/**/*.ts"
    ],
    "exclude": ["node_modules", "dist", "playwright-report", "test-results"]
}
```

Os arrays `include` e `exclude` s√£o cruciais aqui‚Äîeles dizem ao compilador TypeScript exatamente quais arquivos verificar e quais ignorar.

### Etapa 4: üìñCriar o Livro de Regras do ESLint
√â aqui que a m√°gica acontece. Crie um arquivo chamado `eslint.config.mts` no seu diret√≥rio raiz. Este arquivo conter√° todas as regras para garantir a qualidade do c√≥digo.

```typescript
import tseslint from '@typescript-eslint/eslint-plugin';
import tsParser from '@typescript-eslint/parser';
import prettierPlugin from 'eslint-plugin-prettier';
import playwright from 'eslint-plugin-playwright';

const prettierConfig = {
    semi: true,
    tabWidth: 4,
    useTabs: false,
    printWidth: 80,
    singleQuote: true,
    trailingComma: 'es5',
    bracketSpacing: true,
    arrowParens: 'always',
    proseWrap: 'preserve',
};

const config = [
    {
        ignores: ['node_modules', 'dist', 'playwright-report', 'test-results'],
    },
    {
        files: ['**/*.ts', '**/*.tsx'],
        languageOptions: {
            parser: tsParser,
            parserOptions: {
                ecmaVersion: 2020,
                sourceType: 'module',
                project: ['./tsconfig.json'],
                tsconfigRootDir: __dirname,
            },
        },
        plugins: {
            '@typescript-eslint': tseslint,
            prettier: prettierPlugin,
            playwright,
        },
        rules: {
            ...((tseslint.configs.recommended as any).rules ?? {}),
            ...((playwright.configs['flat/recommended'] as any).rules ?? {}),
            'prettier/prettier': ['error', prettierConfig],
            '@typescript-eslint/explicit-function-return-type': 'error',
            '@typescript-eslint/no-explicit-any': 'error',
            '@typescript-eslint/no-unused-vars': [
                'error',
                { argsIgnorePattern: '^_', varsIgnorePattern: '^_' },
            ],
            'no-console': 'error',
            'prefer-const': 'error',
            '@typescript-eslint/no-inferrable-types': 'error',
            '@typescript-eslint/no-empty-function': 'error',
            '@typescript-eslint/no-floating-promises': 'error',
            'playwright/missing-playwright-await': 'error',
            'playwright/no-page-pause': 'error',
            'playwright/no-useless-await': 'error',
            'playwright/no-skipped-test': 'error',
        },
    },
];

export default config;
```

**O que todas essas regras fazem?**

Sua configura√ß√£o ESLint imp√µe um conjunto abrangente de melhores pr√°ticas e padr√µes de qualidade de c√≥digo. Aqui est√° o que cada parte faz:

- **`...tseslint.configs.recommended`**: Este preset do `@typescript-eslint` habilita uma ampla gama de regras que detectam bugs comuns e m√°s pr√°ticas em c√≥digo TypeScript. Ele imp√µe coisas como evitar tipos `any` inseguros, prevenir vari√°veis n√£o usadas, exigir uso adequado de promises e muito mais. Essas regras ajudam a garantir que seu c√≥digo TypeScript seja robusto, mant√≠vel e menos propenso a erros.

- **`...playwright.configs['flat/recommended']`**: Este preset do `eslint-plugin-playwright` imp√µe melhores pr√°ticas para c√≥digo de teste Playwright. Ele detecta erros como `await` ausente em a√ß√µes do Playwright, uso de anota√ß√µes de teste proibidas (como `.only` ou `.skip`), seletores inseguros e muito mais. Isso ajuda a manter seus testes confi√°veis e consistentes.

- **`'prettier/prettier': ['error', prettierConfig]`**: Imp√µe formata√ß√£o de c√≥digo de acordo com suas configura√ß√µes Prettier. Quaisquer problemas de formata√ß√£o ser√£o relatados como erros, garantindo um estilo de c√≥digo consistente em todo o seu projeto.

- **`'@typescript-eslint/explicit-function-return-type': 'error'`**: Exige que todas as fun√ß√µes tenham um tipo de retorno expl√≠cito. Isso melhora a legibilidade do c√≥digo e ajuda a detectar bugs onde uma fun√ß√£o pode retornar um tipo inesperado.

- **`'@typescript-eslint/no-explicit-any': 'error'`**: N√£o permite o uso do tipo `any`. Isso garante que voc√™ use tipos mais precisos, tornando seu c√≥digo mais seguro e f√°cil de manter.

- **`'@typescript-eslint/no-unused-vars': ['error', { argsIgnorePattern: '^_', varsIgnorePattern: '^_' }]`**: Previne vari√°veis n√£o usadas e argumentos de fun√ß√£o, exceto aqueles come√ßando com um underscore (que geralmente s√£o intencionalmente n√£o usados). Isso ajuda a manter seu c√≥digo limpo e livre de desordem.

- **`'no-console': 'error'`**: N√£o permite `console.log` e declara√ß√µes similares. Isso previne logging acidental em c√≥digo de produ√ß√£o, que pode ser n√£o profissional ou vazar informa√ß√µes sens√≠veis.

- **`'prefer-const': 'error'`**: Exige que vari√°veis que nunca s√£o reatribu√≠das ap√≥s declara√ß√£o sejam declaradas com `const`. Isso ajuda a prevenir reatribui√ß√£o acidental e torna a inten√ß√£o do c√≥digo mais clara.

- **`'@typescript-eslint/no-inferrable-types': 'error'`**: N√£o permite declara√ß√µes de tipo expl√≠citas para vari√°veis ou par√¢metros inicializados com um n√∫mero, string ou booleano. Isso mant√©m o c√≥digo mais limpo e aproveita a infer√™ncia de tipo do TypeScript.

- **`'@typescript-eslint/no-empty-function': 'error'`**: N√£o permite fun√ß√µes vazias. Fun√ß√µes vazias s√£o frequentemente um sinal de c√≥digo incompleto ou placeholder e devem ser evitadas.

- **`'@typescript-eslint/no-floating-promises': 'error'`**: Exige que Promises sejam tratadas adequadamente (com `await` ou `.then()`). Isso previne rejei√ß√µes de promise n√£o tratadas e garante que c√≥digo ass√≠ncrono seja confi√°vel.

- **`'playwright/missing-playwright-await': 'error'`**: Garante que todas as a√ß√µes do Playwright (como `page.click()`) sejam adequadamente aguardadas. Await ausente √© uma causa comum de testes inst√°veis.

- **`'playwright/no-page-pause': 'error'`**: N√£o permite o uso de `page.pause()`, que √© destinado a depura√ß√£o e n√£o deve ser deixado em c√≥digo de teste commitado.

- **`'playwright/no-useless-await': 'error'`**: Previne uso desnecess√°rio de `await` em m√©todos s√≠ncronos do Playwright, mantendo seu c√≥digo limpo e eficiente.

- **`'playwright/no-skipped-test': 'error'`**: N√£o permite pular testes usando `.skip`. Isso garante que todos os testes sejam executados e nada seja acidentalmente deixado de fora.

**Como essas regras ajudam?**

Regras definidas como `'error'` bloquear√£o um commit, for√ßando voc√™ a corrigir o problema antes que seu c√≥digo possa ser mesclado. Ao combinar essas regras, seu projeto est√° protegido contra erros comuns, code smells e estilos inconsistentes‚Äîtornando sua base de c√≥digo mais confi√°vel, leg√≠vel e profissional.

### Etapa 5: üîóConectar as Ferramentas com lint-staged
Agora, vamos dizer ao `lint-staged` o que fazer. Adicione o seguinte bloco ao seu `package.json` no n√≠vel raiz (logo ap√≥s as `devDependencies`):

```json
"lint-staged": {
  "*.{ts,tsx,js,jsx}": [
    "npx eslint --fix",
    "npx prettier --write"
  ]
}
```

Esta configura√ß√£o diz ao `lint-staged`: "Para qualquer arquivo TypeScript ou JavaScript staged, primeiro execute o ESLint para corrigir automaticamente o que puder, e ent√£o execute o Prettier para formatar o c√≥digo."

### Etapa 6: üêï‚Äçü¶∫Automatizar o Gatilho com Husky
Finalmente, vamos fazer tudo isso rodar automaticamente antes de cada commit usando Husky.

Primeiro, inicialize o Husky:

```bash
npx husky init
```

Este comando cria um diret√≥rio `.husky` no seu projeto.

‚ö†Ô∏è Em seguida, remova todos os arquivos, exceto `_/pre-commit` e adicione o seguinte script a ele. Este √© o hook que o Git executar√°.

Atualize o conte√∫do do `_/pre-commit` para:

```bash
#!/bin/sh
npx lint-staged
```

Este pequeno script diz ao Git para executar `lint-staged` antes de cada commit. E √© isso! Sua configura√ß√£o est√° completa. üéØ

## üöÄVeja em A√ß√£o: ü§ØVamos Quebrar Algumas Regras

A melhor maneira de apreciar nossa nova rede de seguran√ßa √© v√™-la em a√ß√£o. Vamos tentar fazer commit de algum c√≥digo "ruim".

Crie um novo arquivo de teste chamado `tests/bad-test-example.spec.ts`. Cole o seguinte c√≥digo, que viola intencionalmente v√°rias de nossas regras:

```typescript
// tests/bad-test-example.spec.ts
import { test, expect } from '@playwright/test';

// Viola√ß√£o de regra: Sem tipo de retorno expl√≠cito
function addNumbers(a: number, b: number) {
    //Viola√ß√£o de regra: Sem tipo de retorno expl√≠cito
    const unusedVar = 'I do nothing'; // Viola√ß√£o de regra: Vari√°vel n√£o usada
    return a + b;
}

test('bad example test', async ({ page }) => {
    console.log('This should not be here!'); // Viola√ß√£o de regra: no-console

    await page.goto('https://playwright.dev/');

    page.getByRole('button', { name: 'Get Started' }).click(); //Viola√ß√£o de regra: 'await' ausente para uma a√ß√£o Playwright

    // Viola√ß√£o de regra: 'await' ausente para uma a√ß√£o Playwright
    page.getByLabel('Search').click();

    await page.getByPlaceholder('Search docs').fill('assertions');

    // Viola√ß√£o de regra: Usando page.pause()
    await page.pause();

    await expect(page.getByText('Writing assertions')).toBeVisible(); //Viola√ß√£o de regra: 'await' ausente

    let result;
    await test.step('test', async () => {
        result = addNumbers(1, 2); //Viola√ß√£o de regra: no-explicit-any
    });
    console.log(result); //Viola√ß√£o de regra: no-console
});
```

Agora, tente fazer commit deste arquivo:

```bash
git add .
git commit -m "feat: add broken test file"
```

O que acontece? **Seu commit ser√° REJEITADO!** üõë

Voc√™ ver√° uma sa√≠da no seu terminal do ESLint, listando todos os erros que ele encontrou:

- üö´ O erro `no-console`
- üè∑Ô∏è O tipo de retorno de fun√ß√£o ausente
- ‚è≥ O `await` ausente em `page.getByRole('button', { name: 'Get Started' }).click();` e `page.getByLabel('Search').click();`
- ‚è∏Ô∏è O uso de `page.pause()`
- üóëÔ∏è A vari√°vel n√£o usada

‚ú® `lint-staged` impedir√° que o commit seja conclu√≠do at√© que voc√™ corrija esses erros. O Prettier tamb√©m pode ter corrigido alguns problemas de formata√ß√£o automaticamente.

## O Retorno: C√≥digo Melhor, Equipes Mais Felizes
Voc√™ acabou de implementar um sistema poderoso e automatizado que age como um guardi√£o para sua base de c√≥digo. Esta pequena configura√ß√£o fornece enormes benef√≠cios a longo prazo:

- üßπ **Melhor Qualidade de C√≥digo**: O c√≥digo √© mais limpo, mais leg√≠vel e livre de erros comuns.
- üë• **Aderir √†s Regras da Equipe**: Todos na equipe s√£o automaticamente mantidos aos mesmos padr√µes de codifica√ß√£o, garantindo consist√™ncia em todo o projeto.
- ‚ö° **Revis√µes de C√≥digo Mais R√°pidas**: Os revisores podem se concentrar na l√≥gica do c√≥digo, n√£o em problemas triviais de formata√ß√£o ou estilo.

Ao aplicar esses padr√µes automaticamente, voc√™ libera energia mental para se concentrar no que realmente importa: escrever testes √≥timos e confi√°veis. üß†

## üèÅConclus√£o
Parab√©ns! üéä Voc√™ acabou de construir uma poderosa rede de seguran√ßa para seu projeto Playwright. Esta configura√ß√£o garante que sua base de c√≥digo permane√ßa limpa, leg√≠vel e livre de erros comuns.